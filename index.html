<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Sistema Integral de Monitoreo</title>

  <!-- Leaflet (CSS + JS). Se deja aquÃ­ porque lo usan varios mÃ³dulos. -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>

  <!-- Estilos de la app -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <!-- ========= Topbar ========= -->
    <header class="topbar">
      <div class="brand">
        <div class="brand-text">
          <strong>SISTEMA INTEGRAL DE MONITOREO Y ALERTA</strong>
        </div>
      </div>
      <div class="top-actions"></div>
    </header>

    <main class="layout">
      <!-- ========= Sidebar (Filtros y acciones) ========= -->
      <aside class="sidebar" aria-label="Filtros">
        <!-- ===== Panel: PERSONAL (propiedad del mÃ³dulo personal.js) ===== -->
        <section class="panel">
          <div class="panel-head">
            <h2 class="panel-title">PERSONAL</h2>
            <span class="chip" id="countSerenos">0</span>
          </div>

          <div class="grid-2">
            <div class="field">
              <label class="lbl" for="fechaSerenos">Fecha</label>
              <div class="input affix">
                <span class="affix-l"></span>
                <input id="fechaSerenos" type="date" />
              </div>
            </div>

            <div class="field">
              <span class="lbl">Turno</span>
              <div class="segmented four tiny" role="radiogroup" aria-label="Turno Serenos">
                <input type="radio" name="turnoSerenos" id="ts-todos" value="todos" />
                <label for="ts-todos">Todo</label>

                <input type="radio" name="turnoSerenos" id="ts-t1" value="t1" />
                <label for="ts-t1">T1</label>

                <input type="radio" name="turnoSerenos" id="ts-t2" value="t2" />
                <label for="ts-t2">T2</label>

                <input type="radio" name="turnoSerenos" id="ts-t3" value="t3" />
                <label for="ts-t3">T3</label>
              </div>
            </div>
          </div>

          <div class="grid-2">
            <div class="field">
              <label class="lbl" for="buscador">Nombre o CÃ³digo</label>
              <div class="input affix">
                <input id="buscador" type="search" />
              </div>
            </div>

            <div class="field">
              <label class="check">
                <input id="soloComentario" type="checkbox" />
                <span>Con comentario</span>
              </label>
              <div class="btn-row compact">
                <button id="btnHoyS" class="btn xs">Hoy</button>
              </div>
            </div>
          </div>
        </section>

        <!-- ===== Panel: ALERTAS (propiedad del mÃ³dulo alertas.js) ===== -->
        <section class="panel">
          <div class="panel-head">
            <h2 class="panel-title">ALERTAS</h2>
            <span class="chip alert" id="countAlertas">0</span>
          </div>

          <div class="field">
            <div class="segmented two tiny" role="radiogroup" aria-label="Modo Alertas">
              <input type="radio" name="alertMode" id="am-active" value="active" />
              <label for="am-active">Activas</label>

              <input type="radio" name="alertMode" id="am-range" value="range" />
              <label for="am-range">Por fecha</label>
            </div>
          </div>

          <div id="alertFilters" class="grid-2">
            <div class="field">
              <label class="lbl" for="fechaAlertas">Fecha</label>
              <div class="input affix">
                <span class="affix-l"></span>
                <input id="fechaAlertas" type="date" />
              </div>
            </div>

            <div class="field">
              <span class="lbl">Turno</span>
              <div class="segmented four tiny" role="radiogroup" aria-label="Turno Alertas">
                <input type="radio" name="turnoAlertas" id="ta-todos" value="todos" />
                <label for="ta-todos">Todo</label>

                <input type="radio" name="turnoAlertas" id="ta-t1" value="t1" />
                <label for="ta-t1">T1</label>

                <input type="radio" name="turnoAlertas" id="ta-t2" value="t2" />
                <label for="ta-t2">T2</label>

                <input type="radio" name="turnoAlertas" id="ta-t3" value="t3" />
                <label for="ta-t3">T3</label>
              </div>
              <div class="btn-row compact">
                <button id="btnHoyA" class="btn xs">Hoy</button>
              </div>
            </div>
          </div>
        </section>

        <!-- ===== Panel: REPORTES (propiedad del mÃ³dulo reportes.js) ===== -->
        <section class="panel">
          <div class="panel-head">
            <h2 class="panel-title">Reportes</h2>
          </div>
          <div class="btn-row compact">
            <button id="btnReporteSerenos" class="btn outline">ðŸ“Š Reporte Serenos</button>
            <button id="btnReporteIncidentes" class="btn outline">ðŸ“Š Reporte Incidentes</button>
            <button id="btnReporteCalificaciones" class="btn outline">ðŸ“‹ Ver calificaciones</button>
          </div>
        </section>
      </aside>

      <!-- ========= Mapa (propiedad del mÃ³dulo mapa.js) ========= -->
      <section class="map-wrap">
        <div id="map"></div>
      </section>
    </main>
  </div>

  <!-- ========= Modal de Reportes (lo controla reportes.js) ========= -->
  <div id="modal" class="modal hidden" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="modalTitle">Reporte</h3>
        <button id="modalClose" class="modal-close" aria-label="Cerrar">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="toolbar">
          <div class="segmented two tiny" role="radiogroup" aria-label="Modo Reporte">
            <input type="radio" name="repMode" id="rep-all" value="all" />
            <label for="rep-all">Todo</label>

            <input type="radio" name="repMode" id="rep-day" value="day" />
            <label for="rep-day">Por dÃ­a</label>
          </div>

          <div id="repFilters" class="grid-2" style="display:none; align-items:end;">
            <div class="field">
              <label class="lbl" for="repDate">Fecha</label>
              <div class="input affix">
                <span class="affix-l"></span>
                <input id="repDate" type="date" />
              </div>
            </div>

            <div class="field">
              <span class="lbl">Turno</span>
              <div class="segmented four tiny" role="radiogroup" aria-label="Turno Reporte">
                <input type="radio" name="repTurno" id="rep-todos" value="todos" />
                <label for="rep-todos">Todos</label>

                <input type="radio" name="repTurno" id="rep-t1" value="t1" />
                <label for="rep-t1">T1</label>

                <input type="radio" name="repTurno" id="rep-t2" value="t2" />
                <label for="rep-t2">T2</label>

                <input type="radio" name="repTurno" id="rep-t3" value="t3" />
                <label for="rep-t3">T3</label>
              </div>
            </div>
            <div class="btn-row compact" style="grid-column:1 / -1;">
              <button id="btnRepAplicar" class="btn small">Aplicar</button>
            </div>
          </div>

          <div style="flex:1"></div>
          <button id="btnExport" class="btn small">Exportar</button>
        </div>

        <div class="table-wrap">
          <table class="tbl" id="reportTable">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MÃ³dulos JS ==========
       Cada archivo es independiente y NO comparte lÃ³gica directa entre sÃ­.
       - Firebase.js: inicializa y exporta dbS, dbA, dbL.
       - mapa.js: crea el mapa Leaflet, capas, geocercas, leyendas e iconos.
       - personal.js: maneja panel PERSONAL y pinta marcadores de serenos.
       - alertas.js: maneja panel ALERTAS y pinta marcadores de incidentes.
       - reportes.js: controla el modal/tabla/exportaciÃ³n de reportes.
  -->
  <script type="module" src="js/Firebase.js"></script>
  <script type="module" src="js/mapa.js"></script>
  <script type="module" src="js/personal.js"></script>
  <script type="module" src="js/alertas.js"></script>
  <script type="module" src="js/reportes.js"></script>
</body>
</html>
